{"version":3,"sources":["serviceWorkerRegistration.ts","reportWebVitals.ts","pdf.ts","components/Keyboard.tsx","components/MatchedText.tsx","hooks/use-flag.ts","deferred.ts","hooks/use-keybindings.ts","components/QuickPick.tsx","hooks/use-quick-pick-logic.ts","text-filters.ts","components/CommandPaletteContext.tsx","components/OutlineSelectorContext.tsx","components/InputBoxContext.tsx","components/DropFileArea.tsx","commands.ts","components/LandingPage.tsx","components/SideBar.tsx","components/PageRenderer.tsx","keybindings.ts","scroll.ts","env.ts","components/KFPDFViewer.tsx","hooks/use-repeat-command.ts","components/App.tsx","index.tsx"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","outlineNodeToPageNumber","a","pdf","outlineNode","dest","getDestination","Error","ref","getPageIndex","pageIndex","getPageText","page","getTextContent","tokenizedText","pageText","items","map","token","str","join","getPdfTexts","promises","Array","numPages","fill","_","idx","getPage","Promise","all","keyboardStyle","margin","padding","backgroundColor","border","borderRadius","boxShadow","fontSize","Keyboard","keys","strList","style","MatchedText","memo","text","matchedIndexes","matchedIndexSet","Set","split","s","isMatched","has","color","fontWeight","useFlag","initialValue","useState","value","setValue","set","on","useCallback","off","toggle","currentValue","Deferred","promise","_resolve","_reject","resolve","reject","reason","this","useKeybindings","keybindings","commandCallbacks","commands","bindGlobal","enabled","onBeforeCommand","onAfterCommand","commandCallbacksRef","useRef","current","useEffect","forEach","command","mousetrap","event","preventDefault","bind","unbind","modalStyles","content","display","flexDirection","top","left","right","bottom","marginRight","transform","width","height","overflow","boxSizing","titleStyle","inputStyle","listStyle","listStyleType","listItemStyle","borderBottom","_QuickPickPresentational","title","placeHolder","isOpen","selectedIndex","onClose","onTextChange","onMouseDownOutside","renderItem","parentSelector","selectedListItemRef","scrollIntoView","behavior","block","onMouseDown","onRequestClose","contentLabel","autoFocus","onChange","type","placeholder","item","undefined","name","QuickPickPresentational","React","QUICK_PICK_COMMANDS","quickPickKeybindings","cancelQuickPick","selectItemQuickPick","nextItemQuickPick","previousItemQuickPick","createQuickPickContext","textFilter","QuickPickContext","createContext","showQuickPick","QuickPickProvider","modalAppElement","children","ReactModal","setAppElement","deferredRef","setItems","setPlaceHolder","setTitle","inputText","setInputText","setSelectedIndex","isOpenOn","isOpenOff","matchedItems","setMatchedItems","open","close","select","selectedItem","chanegeInputText","newInputText","nextItem","prev","Math","min","length","previousItem","max","newMatchedItems","push","useQuickPickLogic","target","options","deferred","callbacks","quickPickGlobals","Provider","textFilterMap","substringFilter","pattern","index","indexOf","i","regexFilter","result","foundedStr","err","fuzzyFilter","indexes","c","createTextFilter","textFilterKind","ignoreCase","toLowerCase","itemStyle","itemStyleSelected","isSelected","marginLeft","CommandPaletteContext","CommandPaletteProvider","OutlineSelectorContext","OutlineSelectorProvider","promptStyle","InputBoxPresentational","prompt","INPUT_BOX_COMMANDS","inputBoxKeybindings","cancelInputBox","confirmInputBox","InputBoxContext","showInputBox","InputBoxProvider","setPrompt","inputBoxGlobals","createInputBoxContext","fileDropAreaStyle","position","DropFileArea","onDropFile","accept","dropzoneRef","useDropzone","noKeyboard","noClick","maxFiles","onDrop","acceptedFiles","getRootProps","getInputProps","onClick","stopPropagation","COMMANDS","commandToTitle","replace","v","toUpperCase","landingPageStyle","background","tableStyle","borderCollapse","theadStyle","thStyle","trStyle","tdStyle","LandingPage","commandPaletteOpen","fileOpen","MemorizedOutline","Outline","SideBarStyle","zIndex","SideBar","onItemClick","onLoadSuccess","MemorizedPage","Page","highlightPattern","splitText","matches","reduce","arr","element","PageRenderer","data","scale","rotate","isKeywordHighlighted","keyword","paddingSize","isScrolling","pageWidth","textRenderer","parseFloat","pageNumber","customTextRenderer","onLoadError","message","onRenderError","onGetTextError","renderTextLayer","renderAnnotationLayer","renderInteractiveForms","defaultKeybindings","keysJsonSchema","base","properties","createKeybindingsJsonSchema","Validator","doNothing","fullScreenOn","fullScreenOff","fullScreenToggle","showInfoOn","showInfoOff","showInfoToggle","prevPage","nextPage","firstPage","lastPage","goToPage","zoomReset","zoomIn","zoomOut","zoomFitWidth","zoomFitHeight","scrollLeft","scrollRight","scrollUp","scrollDown","scrollHalfPageDown","scrollHalfPageUp","scrollTop","scrollBottom","scrollReset","rotateRight","rotateLeft","colorInvert","invertColorRateUp","invertColorRateDown","highlightToggle","sidebarToggle","goToOutline","goToOutlineRecursive","search","searchNext","searchPrev","pickSearchList","forwardPageHistory","backwardPageHistory","animationHandlers","cancelRepeatFunc","handler","id","cancelAnimationFrame","startScroll","container","scrollOptions","func","requestAnimationFrame","loop","repeatFunc","scrollBy","isDev","process","KFPDFViewer","fullScreenCommandCallbacks","scrollStep","scrollHalfPageStep","scaleMax","scaleMin","scaleStep","invertColorRateStep","setPdf","outline","setOutline","url","setUrl","setNumPages","setRotate","setScale","pageWidthRaw","setPageWidthRaw","pageHeightRaw","setPageHeightRaw","isSidebarOpen","setIsSidebarOpen","isColorInverted","setIsColorInverted","invertColorRate","setInvertColorRate","showInfo","setShowInfo","setIsScrolling","scrollOffset","setScrollOffset","setKeyword","setIsKeywordHighlighted","pdfTexts","setPdfTexts","keywordHitPages","setKeywordHitPages","listRef","listOuterRef","startListOuterScroll","offset","docRef","commandPalette","useContext","outlineSelector","inputBox","isModalOpen","some","mdl","repeatCount","setRepeatCount","keypressHandler","includes","key","num","Number","currentRepeatCount","keyupHandler","document","addEventListener","removeEventListener","useRepeatCommand","resetRepeatCount","repeatCount1","pageHeight","itemSize","recursive","targetPageNumber","jumpPage","hittedPages","filter","alert","direction","tmpPageNumber","currentPageNumber","step","forward","backward","pop","stopScroll","floor","isInteger","scrollToItem","setScaleAndScroll","newScale","scrollTo","scrollMax","notImplemented","itemData","file","URL","createObjectURL","inputRef","view","x1","y1","x2","y2","cMapUrl","cMapPacked","loading","itemCount","overscanCount","onScroll","outerRef","JSON","stringify","pdfLoaded","App","modalRootRef","fullScreen","setFullScreen","documentElement","clientWidth","screenWidth","setScreenWidth","clientHeight","screenHeight","setScreenHeight","onResize","debounce","fullScrenHandle","useFullScreenHandle","enter","exit","divStyle","body","handle","ReactDOM","render","StrictMode","getElementById","href","origin","fetch","headers","response","contentType","get","status","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.1481ef54.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import type {\n  PDFDocumentProxy,\n  PDFPageProxy,\n} from 'pdfjs-dist/types/display/api';\n\n\ntype PromiseResultType<T> = T extends Promise<infer U> ? U : never;\ntype ReturnType<T> = T extends (...args: any[]) => infer R ? R : never;\ntype ArrayItemType<T> = T extends (infer U)[] ? U : never;\n\ntype GetOutlineType = PDFDocumentProxy['getOutline'];\ntype GetOutlineReturnType = ReturnType<GetOutlineType>;\ntype GetOutlinePromiseResultType = PromiseResultType<GetOutlineReturnType>;\n\ntype OutlineNode = ArrayItemType<GetOutlinePromiseResultType>;\ntype OutlineDest = OutlineNode['dest'];\n\nconst outlineNodeToPageNumber = async ({\n  pdf,\n  outlineNode,\n}: {\n  pdf: PDFDocumentProxy;\n  outlineNode: OutlineNode;\n}): Promise<number> => {\n  // TODO: improve\n  let dest: any[] | null;\n  if (typeof outlineNode.dest === 'string') {\n    dest = await pdf.getDestination(outlineNode.dest);\n  } else {\n    dest = outlineNode.dest;\n  }\n  if (!dest) {\n    throw Error(`can not get destination: ${dest}`);\n  }\n  const ref = dest[0];\n  const pageIndex = await pdf.getPageIndex(ref);\n  return pageIndex + 1;\n};\n\nconst getPageText = async (page: PDFPageProxy): Promise<string> => {\n  const tokenizedText = await page.getTextContent();\n  const pageText = tokenizedText.items\n    .map(token => (token as any).str || '')\n    .join('');\n  return pageText;\n};\n\nconst getPdfTexts = async (pdf: PDFDocumentProxy): Promise<string[]> => {\n  const promises = new Array(pdf.numPages)\n    .fill(null)\n    .map(async (_, idx) => getPageText(await pdf.getPage(idx + 1)));\n  return await Promise.all(promises);\n};\n\nexport {\n  outlineNodeToPageNumber,\n  getPageText,\n  getPdfTexts,\n};\n\nexport type {\n  PDFDocumentProxy,\n  OutlineNode,\n  OutlineDest,\n};\n","import {\n  FC,\n  CSSProperties,\n} from 'react';\n\nimport {\n  Keys,\n} from '../keybindings';\n\nconst keyboardStyle: CSSProperties = {\n  margin: '3px 5px',\n  padding: '1px 3px',\n  backgroundColor: '#f9f9f9',\n  border: '1px solid #aaa',\n  borderRadius: '2px',\n  boxShadow: '1px 2px 2px #ddd',\n  fontSize: '0.85em',\n};\n\nconst Keyboard: FC<{keys: Keys}> = ({keys}: {keys: Keys}) => {\n  const strList: string[] =\n    keys === null\n    ? []\n    : typeof keys === 'string'\n    ? [keys]\n    : keys;\n\n  return (\n    <>\n      {\n        strList.map((str) => (\n          <span\n            key={str}\n            style={keyboardStyle}\n          >\n            {str}\n          </span>\n        ))\n      }\n    </>\n  );\n};\n\nexport {\n  Keyboard,\n};\n","import {\n  FC,\n  CSSProperties,\n  memo,\n} from 'react';\n\nconst MatchedText: FC<{text: string; matchedIndexes: number[]}> = memo(({\n  text,\n  matchedIndexes,\n}) => {\n  const matchedIndexSet = new Set(matchedIndexes);\n  return (\n    <div>\n      {\n        text\n        .split('')\n        .map((s, idx) => {\n          const isMatched = matchedIndexSet.has(idx);\n          const style: CSSProperties = {\n            color: isMatched ? 'coral' : '#333',\n            fontWeight: isMatched ? 'bold' : 'normal',\n          };\n          return (\n            <span\n              key={idx}\n              style={style}\n            >\n              {s}\n            </span>\n          )\n        })\n      }\n    </div>\n  );\n});\n\nexport {\n  MatchedText,\n};\n","import {useState, useCallback} from 'react';\n\nconst useFlag = (initialValue: boolean) => {\n  const [value, setValue] = useState(initialValue);\n\n  const callbacks = {\n    set: setValue,\n\n    on: useCallback(() => {\n      setValue(true);\n    }, []),\n\n    off: useCallback(() => {\n      setValue(false);\n    }, []),\n\n    toggle: useCallback(() => {\n      setValue((currentValue) => !currentValue);\n    }, []),\n  } as const;\n\n  return [value, callbacks] as const;\n};\n\nexport {\n  useFlag,\n};\n","class Deferred<T> {\n  promise: Promise<T>;\n  _resolve: (value: T) => void;\n  _reject: (reason?: any) => void;\n\n  constructor() {\n    this._resolve = () => {\n      throw Error('_resolve is not initialized yet');\n    };\n    this._reject = () => {\n      throw Error('_reject is not initialized yet');\n    };\n    this.promise = new Promise<T>((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  resolve = (value: any) => this._resolve(value);\n  reject = (reason?:any) => this._reject(reason);\n}\n\nexport {\n  Deferred,\n};\n","import {useEffect, useRef} from 'react';\nimport mousetrap from 'mousetrap';\nimport 'mousetrap/plugins/global-bind/mousetrap-global-bind';\n\nimport type {\n  Keys,\n} from '../keybindings';\n\nconst useKeybindings = <AllCommandList extends readonly string[]>({\n  keybindings,\n  commandCallbacks,\n  commands,\n  bindGlobal = false,\n  enabled = true,\n  onBeforeCommand,\n  onAfterCommand,\n}: {\n  keybindings: Record<AllCommandList[number], Keys>;\n  commandCallbacks: Record<AllCommandList[number], () => unknown>;\n  commands: AllCommandList;\n  bindGlobal?: boolean;\n  enabled?: boolean;\n  onBeforeCommand?: (command: AllCommandList[number]) => void;\n  onAfterCommand?: (command: AllCommandList[number]) => void;\n}) => {\n  const commandCallbacksRef = useRef(commandCallbacks);\n  commandCallbacksRef.current = commandCallbacks;\n\n  useEffect(() => {\n    if (!enabled) return;\n    commands.forEach((command: AllCommandList[number]) => {\n      const keys = keybindings[command];\n      if (keys) {\n        // console.log('key bind', keys, command);\n        if (bindGlobal) {\n          mousetrap.bindGlobal(\n            keys,\n            (event) => {\n              event.preventDefault();\n              onBeforeCommand?.(command);\n              commandCallbacksRef.current[command]?.();\n              onAfterCommand?.(command);\n            }\n          );\n        } else {\n          mousetrap.bind(\n            keys,\n            (event) => {\n              event.preventDefault();\n              onBeforeCommand?.(command);\n              commandCallbacksRef.current[command]?.();\n              onAfterCommand?.(command);\n            }\n          );\n        }\n      }\n    });\n\n    return () => {\n      commands.forEach((command: AllCommandList[number]) => {\n        const keys = keybindings[command];\n        // console.log('key unbind', keys, command);\n        if (keys) {\n          mousetrap.unbind(keys);\n        }\n      });\n    };\n  }, [keybindings, enabled, bindGlobal, commands, onBeforeCommand, onAfterCommand]);\n};\n\nexport {\n  useKeybindings,\n};\n","import React, {\n  useState,\n  useRef,\n  useCallback,\n  createContext,\n  ReactNode,\n  CSSProperties,\n  ChangeEventHandler,\n  MouseEventHandler,\n  useEffect,\n} from 'react';\nimport ReactModal from 'react-modal';\n\nimport {\n  useQuickPickLogic,\n} from '../hooks/use-quick-pick-logic';\n\nimport type {\n  QuickPickItem,\n  HasName,\n} from '../hooks/use-quick-pick-logic';\n\nimport {\n  TextFilter,\n} from '../text-filters';\n\nimport {\n  Deferred,\n} from '../deferred';\n\nimport {\n  useKeybindings,\n} from '../hooks/use-keybindings';\nimport type {\n  Keys,\n} from '../keybindings';\n\n\nconst modalStyles = {\n  content: {\n    display: 'flex',\n    flexDirection: 'column',\n    top: '50%',\n    left: '50%',\n    right: 'auto',\n    bottom: 'auto',\n    marginRight: '-50%',\n    transform: 'translate(-50%, -50%)',\n    width: '80%',\n    height: '80%',\n    overflow: 'hidden',\n    padding: '3px',\n    boxSizing: 'border-box',\n  } as CSSProperties,\n};\n\nconst titleStyle: CSSProperties = {\n  margin: 0,\n  padding: '2px 8px',\n  boxSizing: 'border-box',\n  color: '#333',\n};\n\nconst inputStyle: CSSProperties = {\n  width: '100%',\n  margin: 0,\n  padding: '4px 8px',\n  // padding: 0,\n  fontSize: '1.2em',\n  boxSizing: 'border-box',\n  border: 'solid 2px orange',\n  color: '#333',\n};\n\nconst listStyle: CSSProperties = {\n  width: '100%',\n  overflow: 'hidden',\n  listStyleType: 'none',\n  margin: 0,\n  padding: 0,\n  color: '#333',\n};\n\nconst listItemStyle: CSSProperties = {\n  width: '100%',\n  padding: 0,\n  margin: 0,\n  borderBottom: '1px solid #aaa',\n  boxSizing: 'border-box',\n  color: '#333',\n};\n\ninterface QuickPickPresentationalProps<Content extends HasName> {\n  title: string;\n  placeHolder: string;\n  isOpen: boolean;\n  selectedIndex: number;\n  items: QuickPickItem<Content>[];\n  onClose: () => unknown;\n  onTextChange: ChangeEventHandler<HTMLInputElement>;\n  onMouseDownOutside: MouseEventHandler<HTMLDivElement>;\n  renderItem: (\n    item: QuickPickItem<Content>,\n    isSelected: boolean,\n  ) => ReactNode;\n  parentSelector?: () => HTMLElement;\n}\n\nconst _QuickPickPresentational = <Item extends HasName>({\n  title,\n  placeHolder,\n  isOpen,\n  items,\n  selectedIndex,\n  onClose,\n  onTextChange,\n  onMouseDownOutside,\n  renderItem,\n  parentSelector,\n}: QuickPickPresentationalProps<Item>) => {\n  const selectedListItemRef = useRef<HTMLLIElement>(null);\n  useEffect(() => {\n    selectedListItemRef.current?.scrollIntoView({\n      behavior: 'smooth',\n      block: 'nearest',\n    });\n  });\n\n  return (\n    <div onMouseDown={onMouseDownOutside} >\n      <ReactModal\n        isOpen={isOpen}\n        onRequestClose={onClose}\n        style={modalStyles}\n        contentLabel=\"Command Palette\"\n        parentSelector={parentSelector}\n      >\n        {\n          title &&\n          <div style={titleStyle}>{ title }</div>\n        }\n        <input\n          autoFocus\n          onChange={onTextChange}\n          type='text'\n          placeholder={placeHolder}\n          style={inputStyle}\n        ></input>\n        <ul style={listStyle}>\n          {\n            items\n              .map((item, idx) => (\n                <li\n                  key={`${item.name}`}\n                  style={listItemStyle}\n                  ref={idx === selectedIndex ? selectedListItemRef : undefined}\n                >\n                  {renderItem(item, idx === selectedIndex)}\n                </li>\n              ))\n          }\n        </ul>\n      </ReactModal>\n    </div>\n  );\n};\n\n// TODO\nconst QuickPickPresentational = React.memo(_QuickPickPresentational) as any;\n// const QuickPickPresentational = (_QuickPickPresentational);\n\ninterface QuickPickOptions {\n  placeHolder?: string;\n  title?: string;\n}\n\ninterface QuickPickGlobals<Item extends HasName> {\n  isOpen: boolean;\n  showQuickPick: (items: Item[], options?: QuickPickOptions) => Promise<Item | null>;\n  cancelQuickPick: () => void;\n  selectItemQuickPick: () => void;\n  nextItemQuickPick: () => void;\n  previousItemQuickPick: () => void;\n}\n\nconst QUICK_PICK_COMMANDS = [\n  'cancelQuickPick',\n  'selectItemQuickPick',\n  'nextItemQuickPick',\n  'previousItemQuickPick',\n] as const;\n\ntype QuickPickAllCommandList = typeof QUICK_PICK_COMMANDS;\ntype QuickPickCommand = QuickPickAllCommandList[number];\n\nconst quickPickKeybindings: Record<QuickPickCommand, Keys> = {\n  cancelQuickPick: ['esc', 'ctrl+['],\n  selectItemQuickPick: ['enter', 'ctrl+m'],\n  nextItemQuickPick: ['down', 'ctrl+j', 'ctrl+n', 'tab'],\n  previousItemQuickPick: ['up', 'ctrl+k', 'ctrl+p', 'shift+tab'],\n};\n\ntype QuickPickCallbacks = Record<QuickPickCommand, () => unknown>;\n\nconst createQuickPickContext = <Item extends HasName>({\n  renderItem,\n  textFilter,\n}: {\n  renderItem: (item: QuickPickItem<Item>, isSelected: boolean) => ReactNode,\n  textFilter: TextFilter,\n}) => {\n  const QuickPickContext = createContext<QuickPickGlobals<Item>>({\n    isOpen: false,\n    showQuickPick: () => { throw Error('QuickPickGlobals is not initialized yet') },\n    cancelQuickPick: () => { throw Error('QuickPickGlobals is not initialized yet') },\n    selectItemQuickPick: () => { throw Error('QuickPickGlobals is not initialized yet') },\n    nextItemQuickPick: () => { throw Error('QuickPickGlobals is not initialized yet') },\n    previousItemQuickPick: () => { throw Error('QuickPickGlobals is not initialized yet') },\n  });\n\n  const QuickPickProvider = ({\n    parentSelector,\n    modalAppElement = '#root',\n    children\n  }: {\n    parentSelector?: () => HTMLElement;\n    modalAppElement?: string | HTMLElement;\n    children: ReactNode;\n  }) => {\n    ReactModal.setAppElement(modalAppElement);\n    const deferredRef = useRef<Deferred<Item | null> | null>(null);\n    const [items, setItems] = useState<Item[]>([]);\n    const [placeHolder, setPlaceHolder] = useState('');\n    const [title, setTitle] = useState('');\n\n    const {\n      isOpen,\n      open,\n      close,\n      // toggle,\n      nextItem,\n      previousItem,\n      select,\n      chanegeInputText,\n      matchedItems,\n      selectedIndex,\n    } = useQuickPickLogic<Item>({items, textFilter});\n\n    const onTextChange: ChangeEventHandler<HTMLInputElement> = useCallback((event) => {\n      chanegeInputText(event.target.value);\n    }, [chanegeInputText]);\n\n    const showQuickPick = useCallback((items: Item[], options?: QuickPickOptions): Promise<Item | null> => {\n      const {\n        placeHolder = '',\n        title = '',\n      } = options || {};\n\n      setPlaceHolder(placeHolder);\n      setTitle(title);\n\n      setItems(items);\n      const deferred = new Deferred<Item | null>();\n      deferredRef.current = deferred;\n      open();\n      return deferred.promise;\n    }, [open]);\n\n    const cancelQuickPick = useCallback(() => {\n      close();\n      deferredRef.current?.resolve(null);\n    }, [close]);\n\n    const selectItemQuickPick = useCallback(() => {\n      // console.log('selectItemQuickPick')\n      const item = select();\n      deferredRef.current?.resolve(item);\n    }, [select]);\n\n    const callbacks: QuickPickCallbacks = { \n      cancelQuickPick,\n      selectItemQuickPick,\n      nextItemQuickPick: nextItem,\n      previousItemQuickPick: previousItem,\n    };\n\n    // keybindings\n    useKeybindings({\n      keybindings: quickPickKeybindings,\n      commandCallbacks: callbacks,\n      commands: QUICK_PICK_COMMANDS,\n      bindGlobal: true,\n      enabled: isOpen,\n    });\n\n    const quickPickGlobals: QuickPickGlobals<Item> = {\n      isOpen,\n      showQuickPick,\n      ...callbacks,\n    };\n\n    return (\n      <QuickPickContext.Provider\n        value={quickPickGlobals}\n      >\n        {\n          isOpen &&\n          <QuickPickPresentational\n            title={title}\n            placeHolder={placeHolder}\n            isOpen={isOpen}\n            items={matchedItems}\n            selectedIndex={selectedIndex}\n            onClose={cancelQuickPick}\n            onTextChange={onTextChange}\n            onMouseDownOutside={cancelQuickPick}\n            renderItem={renderItem}\n            parentSelector={parentSelector}\n          />\n        }\n        {children}\n      </QuickPickContext.Provider>\n    );\n  };\n\n  return {\n    QuickPickContext,\n    QuickPickProvider,\n  };\n};\n\nexport {\n  createQuickPickContext,\n};\n\nexport type {\n  QuickPickGlobals,\n};\n","import {\n  useState,\n  useEffect,\n  useCallback\n} from 'react';\n\nimport {\n  useFlag,\n} from './use-flag';\n\nimport type {\n  TextFilter,\n} from '../text-filters';\n\ninterface QuickPickItem<Content> {\n  name: string;\n  matchedIndexes: number[];\n  content: Content;\n}\n\ninterface HasName {\n  name: string;\n}\n\nconst useQuickPickLogic = <Item extends HasName>({\n  items,\n  textFilter,\n}: {\n  items: Item[],\n  textFilter: TextFilter,\n}) => {\n  const [inputText, setInputText] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [isOpen, {on: isOpenOn, off: isOpenOff}] = useFlag(false);\n  const [matchedItems, setMatchedItems] = useState<QuickPickItem<Item>[]>([]);\n\n  const open = useCallback(() => {\n    setInputText('');\n    setSelectedIndex(0);\n    isOpenOn();\n  }, [isOpenOn]);\n\n  const close = useCallback(() => {\n    setInputText('');\n    setSelectedIndex(0);\n    isOpenOff();\n  }, [isOpenOff]);\n\n  const toggle = useCallback(() => {\n    if (isOpen) {\n      close();\n    } else {\n      open();\n    }\n  }, [isOpen, open, close]);\n\n  const select = useCallback<() => Item | null>(() => {\n    const selectedItem = matchedItems[selectedIndex]?.content ?? null;\n    close();\n    return selectedItem;\n  }, [selectedIndex, matchedItems, close]);\n\n  const chanegeInputText = useCallback((newInputText: string) => {\n    setInputText(newInputText);\n    setSelectedIndex(0);\n  }, []);\n\n  const nextItem = useCallback(() => {\n    setSelectedIndex((prev) => Math.min(prev + 1, matchedItems.length - 1));\n  }, [matchedItems]);\n\n  const previousItem = useCallback(() => {\n    setSelectedIndex((prev) => Math.max(0, prev - 1));\n  }, []);\n\n  useEffect(() => {\n    const newMatchedItems: QuickPickItem<Item>[] = [];\n    items.forEach((item) => {\n      const matchedIndexes = textFilter(inputText, item.name);\n      if (matchedIndexes !== null) {\n        newMatchedItems.push({\n          name: item.name,\n          matchedIndexes,\n          content: item,\n        });\n      }\n    });\n    setMatchedItems(newMatchedItems);\n  }, [inputText, isOpen, items, textFilter]);\n\n  return {\n    isOpen,\n    open,\n    close,\n    toggle,\n    nextItem,\n    previousItem,\n    select,\n    chanegeInputText,\n    matchedItems,\n    selectedIndex,\n  };\n}\n\nexport {\n  useQuickPickLogic,\n};\n\nexport type {\n  QuickPickItem,\n  HasName,\n};\n\n","type TextFilterKind = 'fuzzyFilter' | 'substringFilter' | 'regexFilter'\ntype TextFilter = (pattern: string, target: string) => number[] | null;\n\nconst substringFilter: TextFilter = (pattern, target) => {\n  const index = target.indexOf(pattern);\n  if(index >= 0) {\n    return Array(pattern.length).fill(0).map((_, i) => i + index);\n  } else {\n    return null\n  }\n};\n\nconst regexFilter: TextFilter = (pattern, target) => {\n  try {\n    const result = target.match(pattern);\n    if(result) {\n      const foundedStr = result[0];\n      const index = result.index;\n      if (index === undefined) {\n        return null;\n      }\n      return Array(foundedStr.length).fill(0).map((_, i) => i + index);\n    } else {\n      return null\n    }\n  } catch(err) {\n    // regex syntax error\n    return null;\n  }\n};\n\nconst fuzzyFilter: TextFilter = (pattern, target) => {\n  const indexes = [];\n  let index = 0;\n  for (const c of pattern) {\n    index = target.indexOf(c, index);\n    if (index < 0) return null;\n    indexes.push(index);\n    index++;\n  }\n  return indexes;\n};\n\nconst textFilterMap: Record<TextFilterKind, TextFilter> = {\n  substringFilter,\n  regexFilter,\n  fuzzyFilter,\n};\n\nconst createTextFilter = (\n  textFilterKind: TextFilterKind,\n  options?: {\n    ignoreCase?: boolean,\n  }\n): TextFilter => {\n  const {\n    ignoreCase = false,\n  } = options ?? {};\n\n  const textFilter = (pattern: string, target: string) => {\n    if (ignoreCase) {\n      pattern = pattern.toLowerCase();\n      target = target.toLowerCase();\n    };\n    return textFilterMap[textFilterKind](pattern, target);\n  };\n\n  return textFilter;\n};\n\nexport {\n  substringFilter,\n  regexFilter,\n  fuzzyFilter,\n  createTextFilter,\n};\n\nexport type {\n  TextFilterKind,\n  TextFilter,\n};\n","import {\n  CSSProperties,\n} from 'react';\nimport {\n  Keyboard,\n} from './Keyboard';\n\nimport {\n  MatchedText,\n} from './MatchedText';\n\nimport {\n  createQuickPickContext,\n} from './QuickPick';\n\nimport {\n  Keys,\n} from '../keybindings';\n\nimport {\n  createTextFilter,\n} from '../text-filters'\n\nimport type {\n  Command,\n} from '../commands';\n\ninterface CommandPaletteItem {\n  name: string;\n  command: Command;\n  keys: Keys;\n}\n\nconst itemStyle: CSSProperties = {\n  display: 'flex',\n  backgroundColor: 'white',\n  width: '100%',\n  height: '100%',\n  margin: 0,\n  padding: '4px 8px',\n  boxSizing: 'border-box',\n};\n\nconst itemStyleSelected: CSSProperties = {\n  ...itemStyle,\n  backgroundColor: '#ddd',\n};\n\nconst renderItem = (\n  {name, matchedIndexes, content}: any,\n  isSelected: boolean,\n) => {\n  return (\n    <div\n      style={isSelected ? itemStyleSelected : itemStyle}\n    >\n      <MatchedText text={name} matchedIndexes={matchedIndexes} />\n      <div style={{marginLeft: 'auto'}}>\n        <Keyboard keys={content.keys} />\n      </div>\n    </div>\n  );\n};\n\nconst {\n  QuickPickContext: CommandPaletteContext,\n  QuickPickProvider: CommandPaletteProvider,\n} = createQuickPickContext<CommandPaletteItem>({\n  renderItem,\n  textFilter: createTextFilter('fuzzyFilter', {ignoreCase: true}),\n});\n\nexport {\n  CommandPaletteContext,\n  CommandPaletteProvider,\n};\n","import {\n  CSSProperties,\n} from 'react';\n\nimport {\n  MatchedText,\n} from './MatchedText';\n\nimport {\n  createQuickPickContext,\n} from './QuickPick';\n\nimport {\n  createTextFilter,\n} from '../text-filters'\n\nimport type {\n  OutlineNode\n} from '../pdf';\n\ninterface OutlineNodeItem {\n  name: string;\n  content: OutlineNode;\n}\n\nconst itemStyle: CSSProperties = {\n  backgroundColor: 'white',\n  width: '100%',\n  height: '100%',\n  margin: 0,\n  padding: '4px 8px',\n  boxSizing: 'border-box',\n};\n\nconst itemStyleSelected: CSSProperties = {\n  ...itemStyle,\n  backgroundColor: '#ddd',\n};\n\nconst renderItem = (\n  {name, matchedIndexes}: {name: string; matchedIndexes: number[]},\n  isSelected: boolean,\n) => {\n  return (\n    <div\n      style={isSelected ? itemStyleSelected : itemStyle}\n    >\n      <MatchedText text={name} matchedIndexes={matchedIndexes} />\n    </div>\n  );\n};\n\nconst {\n  QuickPickContext: OutlineSelectorContext,\n  QuickPickProvider: OutlineSelectorProvider,\n} = createQuickPickContext<OutlineNodeItem>({\n  renderItem,\n  textFilter: createTextFilter('fuzzyFilter', {ignoreCase: true}),\n});\n\nexport {\n  OutlineSelectorContext,\n  OutlineSelectorProvider,\n};\n\nexport type {\n  OutlineNodeItem,\n};\n","import {\n  useState,\n  useCallback,\n  useRef,\n  createContext,\n  ReactNode,\n  CSSProperties,\n  ChangeEventHandler,\n  MouseEventHandler,\n} from 'react';\nimport ReactModal from 'react-modal';\n\nimport {\n  useFlag\n} from '../hooks/use-flag';\n\nimport {\n  Deferred,\n} from '../deferred';\n\nimport {\n  useKeybindings,\n} from '../hooks/use-keybindings';\nimport type {\n  Keys,\n} from '../keybindings';\n\nconst modalStyles = {\n  content: {\n    top: '50%',\n    left: '50%',\n    right: 'auto',\n    bottom: 'auto',\n    marginRight: '-50%',\n    transform: 'translate(-50%, -50%)',\n    width: '80%',\n    height: '20%',\n    overflow: 'hidden',\n    padding: '3px',\n    boxSizing: 'border-box',\n  } as CSSProperties,\n};\n\nconst promptStyle: CSSProperties = {\n  margin: 0,\n  padding: '2px 8px',\n  boxSizing: 'border-box',\n  color: '#333',\n};\n\nconst inputStyle: CSSProperties = {\n  width: '100%',\n  margin: 0,\n  padding: '4px 8px',\n  // padding: 0,\n  fontSize: '1.2em',\n  boxSizing: 'border-box',\n  border: 'solid 2px orange',\n  color: '#333',\n};\n\ninterface InputBoxPresentationalProps {\n  prompt: string;\n  placeHolder: string;\n  isOpen: boolean;\n  onClose: () => unknown;\n  onTextChange: ChangeEventHandler<HTMLInputElement>;\n  onMouseDownOutside: MouseEventHandler<HTMLDivElement>;\n  parentSelector?: () => HTMLElement;\n}\n\nconst InputBoxPresentational = ({\n  prompt,\n  placeHolder,\n  isOpen,\n  onClose,\n  onTextChange,\n  onMouseDownOutside,\n  parentSelector,\n}: InputBoxPresentationalProps) => {\n  return (\n    <div onMouseDown={onMouseDownOutside} >\n      <ReactModal\n        isOpen={isOpen}\n        onRequestClose={onClose}\n        style={modalStyles}\n        contentLabel=\"Input Box\"\n        parentSelector={parentSelector}\n      >\n        <input\n          autoFocus\n          onChange={onTextChange}\n          type='text'\n          placeholder={placeHolder}\n          style={inputStyle}\n        ></input>\n        {\n          prompt &&\n          <div style={promptStyle}>{ prompt }</div>\n        }\n      </ReactModal>\n    </div>\n  );\n};\n\ninterface InputBoxOptions {\n  // title?: string;\n  prompt?: string;\n  placeHolder?: string;\n}\n\ninterface InputBoxGlobals {\n  isOpen: boolean;\n  showInputBox: (options?: InputBoxOptions) => Promise<string | null>;\n  cancelInputBox: () => void;\n  confirmInputBox: () => void;\n}\n\nconst INPUT_BOX_COMMANDS = [\n  'cancelInputBox',\n  'confirmInputBox',\n] as const;\n\ntype InputBoxAllCommandList = typeof INPUT_BOX_COMMANDS;\ntype InputBoxCommand = InputBoxAllCommandList[number];\n\nconst inputBoxKeybindings: Record<InputBoxCommand, Keys> = {\n  cancelInputBox: ['esc', 'ctrl+['],\n  confirmInputBox: ['enter', 'ctrl+m'],\n};\n\nconst createInputBoxContext = () => {\n  const InputBoxContext = createContext<InputBoxGlobals>({\n    isOpen: false,\n    showInputBox: () => { throw Error('InputBoxGlobals is not initialized yet') },\n    cancelInputBox: () => { throw Error('InputBoxGlobals is not initialized yet') },\n    confirmInputBox: () => { throw Error('InputBoxGlobals is not initialized yet') },\n  });\n\n  const InputBoxProvider = ({\n    parentSelector,\n    modalAppElement = '#root',\n    children,\n  }: {\n    parentSelector?: () => HTMLElement;\n    modalAppElement?: string | HTMLElement;\n    children: ReactNode;\n  }) => {\n    ReactModal.setAppElement(modalAppElement);\n\n    const deferredRef = useRef<Deferred<string | null> | null>(null);\n    const [placeHolder, setPlaceHolder] = useState('');\n    const [prompt, setPrompt] = useState('');\n    const [inputText, setInputText] = useState('');\n\n    const [\n      isOpen,\n      {\n        on: isOpenOn,\n        off: isOpenOff,\n      }\n    ] = useFlag(false);\n\n    const open = useCallback(() => {\n      isOpenOn();\n      setInputText('');\n    }, [isOpenOn]);\n\n    const close = useCallback(() => {\n      isOpenOff();\n    }, [isOpenOff]);\n\n    const onTextChange: ChangeEventHandler<HTMLInputElement> = useCallback((event) => {\n      setInputText(event.target.value);\n    }, []);\n\n    const showInputBox = (options?: InputBoxOptions): Promise<string | null> => {\n      const {\n        placeHolder = '',\n        prompt = '',\n      } = options || {};\n\n      setPlaceHolder(placeHolder);\n      setPrompt(prompt);\n\n      const deferred = new Deferred<string | null>();\n      deferredRef.current = deferred;\n      open();\n      return deferred.promise;\n    };\n\n    const cancelInputBox = () => {\n      close();\n      deferredRef.current?.resolve(null);\n    };\n\n    const confirmInputBox = () => {\n      close();\n      deferredRef.current?.resolve(inputText);\n    };\n\n    const callbacks = {\n      cancelInputBox,\n      confirmInputBox,\n    };\n\n    useKeybindings({\n      keybindings: inputBoxKeybindings,\n      commandCallbacks: callbacks,\n      commands: INPUT_BOX_COMMANDS,\n      bindGlobal: true,\n      enabled: isOpen,\n    });\n\n    const inputBoxGlobals: InputBoxGlobals = {\n      isOpen,\n      showInputBox,\n      cancelInputBox,\n      confirmInputBox,\n    };\n\n    return (\n      <InputBoxContext.Provider\n        value={inputBoxGlobals}\n      >\n        {\n          isOpen &&\n          <InputBoxPresentational\n            prompt={prompt}\n            placeHolder={placeHolder}\n            isOpen={isOpen}\n            onClose={cancelInputBox}\n            onTextChange={onTextChange}\n            onMouseDownOutside={cancelInputBox}\n            parentSelector={parentSelector}\n          />\n        }\n        {children}\n      </InputBoxContext.Provider>\n    );\n  };\n\n  return {\n    InputBoxContext,\n    InputBoxProvider,\n  };\n};\n\n\nconst {\n  InputBoxContext,\n  InputBoxProvider,\n} = createInputBoxContext();\n\nexport {\n  InputBoxContext,\n  InputBoxProvider,\n};\n\nexport type {\n  InputBoxGlobals,\n};\n","import * as React from 'react'\nimport {useDropzone, DropzoneRef} from 'react-dropzone'\n\ninterface IDropFileArea {\n  onDropFile(file: File): void;\n  children: any;\n  accept?: string | string[];\n  dropzoneRef?: React.MutableRefObject<DropzoneRef | null>,\n}\n\nconst fileDropAreaStyle: React.CSSProperties = {\n  position: 'fixed',\n  top: 0,\n  left: 0,\n  width: '100%',\n  height: '100%',\n};\n\nconst DropFileArea: React.FC<IDropFileArea> = ({\n  onDropFile,\n  children,\n  accept,\n  dropzoneRef,\n}) => {\n  const onDrop = (acceptedFiles: File[]) => {\n    onDropFile(acceptedFiles[0]);\n  };\n  const {getRootProps, getInputProps, open} = useDropzone({\n    noKeyboard: true,\n    noClick: true,\n    maxFiles: 1,\n    onDrop,\n    accept,\n  })\n\n  if (dropzoneRef) {\n    dropzoneRef.current = {open};\n  }\n\n  return (\n    <div {...getRootProps({\n        onClick: (event: React.MouseEvent<HTMLElement, MouseEvent>) => event.stopPropagation(),\n      })}\n      style={fileDropAreaStyle}\n    >\n      <input {...getInputProps()} />\n      { children }\n    </div>\n  )\n}\n\nexport {\n  DropFileArea\n};\n","const FULL_SCREEN_COMMANDS = [\n  'fullScreenOn',\n  'fullScreenOff',\n  'fullScreenToggle',\n] as const;\n\nconst SHOW_INFO_COMMANDS = [\n  'showInfoOn',\n  'showInfoOff',\n  'showInfoToggle',\n] as const;\n\nconst PAGE_COMMANDS = [\n  'prevPage',\n  'nextPage',\n  'firstPage',\n  'lastPage',\n  'goToPage',\n] as const;\n\nconst ZOOM_COMMANDS = [\n  'zoomReset',\n  'zoomIn',\n  'zoomOut',\n  'zoomFitWidth',\n  'zoomFitHeight',\n] as const;\n\nconst SCROLL_COMMANDS = [\n  'scrollLeft',\n  'scrollRight',\n  'scrollUp',\n  'scrollDown',\n  'scrollHalfPageDown',\n  'scrollHalfPageUp',\n  'scrollTop',\n  'scrollBottom',\n  'scrollReset',\n] as const;\n\nconst ROTATE_COMMANDS = [\n  'rotateRight',\n  'rotateLeft',\n] as const;\n\nconst COLOR_COMMANDS = [\n  'colorInvert',\n  'invertColorRateUp',\n  'invertColorRateDown',\n] as const;\n\nconst OUTLINE_COMMANDS = [\n  'goToOutline',\n  'goToOutlineRecursive',\n] as const;\n\nconst SEARCH_COMMANDS = [\n  'search',\n  'searchNext',\n  'searchPrev',\n  'pickSearchList',\n  'highlightToggle',\n] as const;\n\nconst HISTORY_COMMANDS = [\n  'forwardPageHistory',\n  'backwardPageHistory',\n] as const;\n\nconst COMMANDS = [\n  'doNothing',\n\n  ...FULL_SCREEN_COMMANDS,\n  ...SHOW_INFO_COMMANDS,\n  ...PAGE_COMMANDS,\n  ...ZOOM_COMMANDS,\n  ...SCROLL_COMMANDS,\n  ...ROTATE_COMMANDS,\n  ...COLOR_COMMANDS,\n\n  'sidebarToggle',\n\n  ...OUTLINE_COMMANDS,\n  ...SEARCH_COMMANDS,\n  ...HISTORY_COMMANDS,\n\n  'commandPaletteOpen',\n  'fileOpen',\n] as const;\n\ntype AllCommandList = typeof COMMANDS;\n\ntype Command = AllCommandList[number];\n\ntype FullScreenCommand = typeof FULL_SCREEN_COMMANDS[number];\ntype ShowInfoCommand = typeof SHOW_INFO_COMMANDS[number];\ntype PageCommand = typeof PAGE_COMMANDS[number];\ntype ZoomCommand = typeof ZOOM_COMMANDS[number];\ntype ScrollCommand = typeof SCROLL_COMMANDS[number];\ntype RotateCommand = typeof ROTATE_COMMANDS[number];\ntype ColorCommand = typeof COLOR_COMMANDS[number];\ntype OutlineCommand = typeof OUTLINE_COMMANDS[number];\ntype SearchCommand = typeof SEARCH_COMMANDS[number];\ntype HistoryCommand = typeof HISTORY_COMMANDS[number];\n\nconst isCommand = (obj: any): obj is Command => {\n  return (\n    typeof obj === 'string'\n    && (COMMANDS as readonly string[]).includes(obj)\n  );\n};\n\n// interface CommandCallbackObjType {\n//   keyup: () => unknown;\n//   keydown: () => unknown;\n//   keypress: () => unknown;\n// };\n\ntype CommandCallback = (\n  (() => unknown)\n);\n\n// type CommandCallbacks = Partial<Record<Command, () => unknown>>;\ntype CommandCallbacks = Record<Command, CommandCallback>;\n\nconst commandToTitle = (command: Command): string => {\n  // example: 'fullScreenOn' -> 'Full Screen On'\n  return command\n    .replace(/^(\\w)/, (v) => v.toUpperCase())\n    .replace(/([a-z])([A-Z])/g, '$1 $2')\n    .replace(/([a-zA-Z])(\\d)/g, '$1 $2')\n    .replace(/(\\d)([a-zA-Z])/g, '$1 $2');\n};\n\nexport {\n  COMMANDS,\n  commandToTitle,\n  isCommand,\n  FULL_SCREEN_COMMANDS,\n  SHOW_INFO_COMMANDS,\n  PAGE_COMMANDS,\n  ZOOM_COMMANDS,\n  SCROLL_COMMANDS,\n  ROTATE_COMMANDS,\n  COLOR_COMMANDS,\n  OUTLINE_COMMANDS,\n  SEARCH_COMMANDS,\n  HISTORY_COMMANDS,\n};\n\nexport type {\n  AllCommandList,\n  Command,\n  CommandCallback,\n  CommandCallbacks,\n  FullScreenCommand,\n  ShowInfoCommand,\n  PageCommand,\n  ZoomCommand,\n  ScrollCommand,\n  RotateCommand,\n  ColorCommand,\n  OutlineCommand,\n  SearchCommand,\n  HistoryCommand,\n};\n","import {CSSProperties, FC} from 'react';\nimport {Keyboard} from './Keyboard';\n\nimport {\n  COMMANDS,\n  commandToTitle,\n} from '../commands';\nimport type {\n  Keybindings\n} from '../keybindings';\n\nconst landingPageStyle: CSSProperties = {\n  padding: '0px 40px',\n  background: 'white',\n  width: '100%',\n  height: '100%',\n  overflow: 'scroll',\n};\n\nconst tableStyle: CSSProperties = {\n  borderCollapse: 'collapse',\n  // border: '#ddd',\n};\n\nconst theadStyle: CSSProperties = {\n  backgroundColor: '#777',\n  color: '#eee',\n  border: '1px solid #ddd',\n  padding: '4px',\n};\n\nconst thStyle: CSSProperties = {\n  padding: '4px',\n};\n\nconst trStyle: CSSProperties = {\n  padding: '4px',\n};\n\nconst tdStyle: CSSProperties = {\n  padding: '4px',\n};\n\ninterface LandingPageProps {\n  keybindings: Keybindings;\n}\n\nconst LandingPage: FC<LandingPageProps> = ({\n  keybindings,\n}) => (\n  <div\n    style={landingPageStyle}\n  >\n    <h3>How to Use</h3>\n    <ul>\n      <li>command palette: <Keyboard keys={keybindings.commandPaletteOpen} /></li>\n      <li>open file:\n        <ul>\n          <li>drag and drop PDF file here.</li>\n          <li>keyboard shortcuts: <Keyboard keys={keybindings.fileOpen} /></li>\n          <li>choose 'File Open' command in command palette</li>\n        </ul>\n      </li>\n    </ul>\n\n    <h3>Keybindings</h3>\n    <table style={tableStyle} >\n      <thead style={theadStyle} >\n        <tr>\n          <th style={thStyle} >command</th>\n          <th style={thStyle} >keybord shortcuts</th>\n        </tr>\n      </thead>\n      <tbody>\n        {\n          COMMANDS.map((command, idx) => (\n            <tr\n              key={command}\n              style={{\n                ...trStyle,\n                backgroundColor: idx % 2 === 0 ? '#eee' : '#fff',\n              }} \n            >\n              <td style={tdStyle} >{commandToTitle(command)}</td>\n              <td style={tdStyle} ><Keyboard keys={keybindings[command]} /></td>\n            </tr>\n          ))\n        }\n      </tbody>\n    </table>\n  </div>\n);\n\nexport {\n  LandingPage,\n}\n","import {CSSProperties, memo} from 'react';\n\nimport {\n  Outline,\n} from 'react-pdf';\n\nimport {\n  OutlineNode,\n} from '../pdf';\n\nconst MemorizedOutline = memo(Outline);\n\ninterface SideBarProps {\n  onItemClick: ({pageNumber}: {pageNumber: string}) => void;\n  onLoadSuccess: (outline: OutlineNode[]) => void;\n  isOpen: boolean;\n}\n\nconst SideBarStyle: CSSProperties = {\n  position: 'fixed',\n  zIndex: 999,\n};\n\nconst SideBar = ({\n  onItemClick,\n  onLoadSuccess,\n  isOpen,\n}: SideBarProps) => {\n  return (\n    <div\n      style={{\n        ...SideBarStyle,\n        display: isOpen ? 'block' : 'none',\n      }}\n    >\n      <MemorizedOutline\n        onItemClick={onItemClick}\n        onLoadSuccess={onLoadSuccess}\n      />\n    </div>\n  );\n};\n\nexport {\n  SideBar,\n};\n","import {CSSProperties, memo, useCallback} from 'react';\nimport {Page} from 'react-pdf';\n\nconst MemorizedPage = memo(Page);\n\ninterface PageRendererDataType {\n  scale: number;\n  rotate: number;\n  isKeywordHighlighted: boolean;\n  keyword: string;\n  paddingSize: number;\n  isScrolling: boolean;\n  pageWidth: number;\n}\n\ninterface PageRendererProps {\n  index: number;\n  style: CSSProperties;\n  data: PageRendererDataType;\n}\n\nconst highlightPattern = (text: string, pattern: any) => {\n  const splitText = text.split(pattern);\n\n  if (splitText.length <= 1) {\n    return text;\n  }\n\n  const matches = text.match(pattern);\n\n  return (\n    splitText.reduce((arr: string[], element: any, index: number) => (matches && matches[index] ? [\n      ...arr,\n      element,\n      <span\n        key={index}\n        style={{\n          background: 'rgba(255, 0, 0, 0.3)',\n        }}\n      >\n        {matches[index]}\n      </span>,\n    ] : [...arr, element]), [])\n  );\n};\n\nconst PageRenderer = ({index, style, data}: any) => {\n  const {\n    scale,\n    rotate,\n    isKeywordHighlighted,\n    keyword,\n    paddingSize,\n    isScrolling,\n    pageWidth,\n  } = data;\n\n  const textRenderer = useCallback(({str}: any) => {\n    return <>{highlightPattern(str, keyword)}</>;\n  }, [keyword]);\n\n  // console.log(style);\n  return (\n    <div style={{\n      ...style,\n      top: `${parseFloat(style.top) + paddingSize}px`,\n    }}\n    >\n      <div\n        style={{\n          width: `${pageWidth}px`,\n          margin: 'auto',\n        }}\n      >\n        <MemorizedPage\n          pageNumber={index + 1}\n          scale={scale}\n          rotate={rotate}\n          customTextRenderer={isKeywordHighlighted ? textRenderer : undefined}\n          onLoadError={useCallback((error) => console.error('Error while loading page! ' + error.message), [])}\n          onRenderError={useCallback((error) => console.error('Error while loading page! ' + error.message), [])}\n          onGetTextError={useCallback((error) => console.error('Error while loading text layer items! ' + error.message), [])}\n          renderTextLayer={!isScrolling}\n          renderAnnotationLayer={false}\n          renderInteractiveForms={false}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport {\n  PageRenderer,\n};\n\nexport type {\n  PageRendererProps,\n  PageRendererDataType,\n};\n","import {\n  COMMANDS,\n} from './commands';\n\nimport type {\n  Command,\n} from './commands';\n\nimport {\n  Validator,\n} from 'jsonschema';\n\ntype Keys = string | string[] | null;\n// type Keybindings = Partial<Record<Command, Keys>>;\ntype Keybindings = Record<Command, Keys>;\n\nconst createKeybindingsJsonSchema = () => {\n  const keysJsonSchema = {\n    \"anyOf\": [\n      {\n        \"type\": \"null\"\n      },\n      {\n        \"type\": \"string\"\n      },\n      {\n        \"type\": \"array\",\n        \"items\": [\n          {\n            \"type\": \"string\"\n          },\n          {\n            \"type\": \"string\"\n          }\n        ]\n      },\n    ],\n  };\n  const base: any = {\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"type\": \"object\",\n    \"additionalProperties\": false,\n    \"properties\": {\n    },\n    \"required\": [\n    ],\n  };\n  COMMANDS.forEach((command: Command) => {\n    base.properties[command] = keysJsonSchema;\n    // partial keybindings is OK for now.\n    // base.required.push(command);\n  });\n  return base;\n};\n\nconst keybindingsJsonSchema = createKeybindingsJsonSchema();\nconst keybindingsJsonSchemaValidator = new Validator();\n\n// const isKeys = (obj: any): obj is Keys => {\n//   return (\n//     (obj === null)\n//     || (typeof obj === 'string')\n//     || (\n//       (typeof obj === 'object') \n//       && (obj instanceof Array)\n//       && obj.every((s) => (typeof s === 'string'))\n//     )\n//   );\n// };\n\n// const isKeybindings = (obj: any): obj is Keybindings => {\n//   return (\n//     (typeof obj === 'object')\n//     && (obj !== null)\n//     && COMMANDS.every((command) => isKeys(obj[command]))\n//   );\n// };\n\nconst isPartialKeybindings = (obj: any): obj is Partial<Keybindings> => {\n  const result = keybindingsJsonSchemaValidator.validate(obj, keybindingsJsonSchema);\n  if (result.valid) {\n    return true;\n  } else {\n    throw result.errors;\n  }\n\n  // return (\n  //   (typeof obj === 'object')\n  //   && (obj !== null)\n  //   && Object.keys(obj).every((key) => isCommand(key) && isKeys(obj[key]))\n  // );\n};\n\nconst defaultKeybindings: Keybindings = {\n  doNothing: null,\n\n  fullScreenOn: null,\n  fullScreenOff: null,\n  fullScreenToggle: 'f',\n\n  showInfoOn: null,\n  showInfoOff: null,\n  showInfoToggle: 's',\n\n  prevPage: [/*'p',*/ 'shift+space', 'pageup',],\n  nextPage: [/*'n',*/ 'space', 'pagedown'],\n  firstPage: ['g', 'ctrl+home'],\n  lastPage: ['G', 'ctrl+end'],\n  goToPage: ['ctrl+g', 'command+g'],\n\n  zoomReset: '=',\n  zoomIn: '+',\n  zoomOut: '-',\n\n  zoomFitWidth: 'w',\n  zoomFitHeight: 'e',\n\n  scrollLeft: ['h', 'left'],\n  scrollRight: ['l', 'right'],\n  scrollUp: ['k', 'up'],\n  scrollDown: ['j', 'down'],\n  scrollHalfPageDown: 'd',\n  scrollHalfPageUp: 'u',\n\n  scrollTop: ['home', 'z t'],\n  scrollBottom: ['end', 'z b'],\n  scrollReset: 'M',\n\n  rotateRight: '>',\n  rotateLeft: '<',\n\n  colorInvert: 'i',\n  invertColorRateUp: ')',\n  invertColorRateDown: '(',\n\n  highlightToggle: '#',\n  sidebarToggle: 'b',\n\n  goToOutline: 'o',\n  goToOutlineRecursive: 'O',\n\n  search: '/',\n  searchNext: 'n',\n  searchPrev: 'N',\n\n  pickSearchList: null,\n  forwardPageHistory: 'L',\n  backwardPageHistory: 'H',\n\n  commandPaletteOpen: [':', 'command+shift+p', 'ctrl+shift+p'],\n  fileOpen: ['command+o', 'ctrl+o'],\n};\n\nexport {\n  defaultKeybindings,\n  isPartialKeybindings,\n};\n\nexport type {\n  Keys,\n  Keybindings,\n}\n","const animationHandlers: Handler[] = [];\n\ninterface Handler {\n  id?: number;\n}\n\nconst repeatFunc = (func: () => void): Handler => {\n  let handler: Handler = {};\n  const loop = () => {\n    func();\n    // reserve next frame process\n    handler.id = requestAnimationFrame(loop);\n  }\n  // first call\n  handler.id = requestAnimationFrame(loop);\n  return handler;\n};\n\nconst cancelRepeatFunc = (handler: Handler) => {\n  if(handler.id !== undefined) {\n    cancelAnimationFrame(handler.id);\n  }\n};\n\nconst startScroll = (container: HTMLElement, scrollOptions: any): void => {\n  if(animationHandlers.length > 0)return;\n  //stopScroll();\n  const handler = repeatFunc(() => {\n    container.scrollBy(scrollOptions);\n  });\n  animationHandlers.push(handler);\n};\n\nconst stopScroll = (): void => {\n  while(true) {\n    const handler = animationHandlers.pop();\n    if (!handler) break;\n    cancelRepeatFunc(handler);\n  }\n};\n\nexport {startScroll, stopScroll};\n","const isDev = process.env.NODE_ENV === 'development';\n\nexport {\n  isDev,\n};\n","import {\n  FC,\n  useState,\n  useEffect,\n  useContext,\n  useRef,\n} from 'react';\nimport {\n  Document,\n} from 'react-pdf';\n\nimport type {DropzoneRef} from 'react-dropzone';\n\nimport {\n  getPdfTexts,\n  outlineNodeToPageNumber,\n} from '../pdf';\nimport type {\n  PDFDocumentProxy,\n  OutlineNode,\n} from '../pdf';\n\nimport {FixedSizeList as List} from 'react-window';\n\nimport {CommandPaletteContext, } from './CommandPaletteContext';\nimport {OutlineSelectorContext, } from './OutlineSelectorContext';\nimport {InputBoxContext, } from './InputBoxContext';\n\nimport {DropFileArea} from './DropFileArea';\nimport {LandingPage} from './LandingPage';\n\nimport {SideBar} from './SideBar';\nimport {PageRenderer} from './PageRenderer';\nimport type {PageRendererDataType} from './PageRenderer';\n\nimport {defaultKeybindings} from '../keybindings';\nimport type {Keybindings} from '../keybindings';\n\nimport {useKeybindings} from '../hooks/use-keybindings';\nimport {useRepeatCommand} from '../hooks/use-repeat-command';\n\nimport {\n  startScroll,\n  stopScroll,\n} from '../scroll';\n\nimport {\n  CommandCallback,\n  CommandCallbacks,\n  COMMANDS,\n  commandToTitle,\n} from '../commands';\nimport type {\n  AllCommandList,\n  FullScreenCommand,\n} from '../commands';\n\nimport {isDev} from '../env';\n\ninterface KFPDFViewerProps {\n  fullScreenCommandCallbacks: Record<FullScreenCommand, CommandCallback>;\n  height: number;\n  width: number;\n  paddingSize?: number;\n  scrollStep?: number;\n  scrollHalfPageStep?: number;\n  scaleMax?: number;\n  scaleMin?: number;\n  scaleStep?: number;\n  invertColorRateStep?: number;\n};\n\nconst KFPDFViewer: FC<KFPDFViewerProps> = ({\n  fullScreenCommandCallbacks,\n  height,\n  width,\n  paddingSize = 5,\n  scrollStep = 25,\n  scrollHalfPageStep = 60,\n  scaleMax = 4,\n  scaleMin = 0.1,\n  scaleStep = 0.1,\n  invertColorRateStep = 0.05,\n}) => {\n\n  // state\n  const [pdf, setPdf] = useState<PDFDocumentProxy | null>(null);\n  const [outline, setOutline] = useState<OutlineNode[] | null>(null);\n\n  const [keybindings] = useState<Keybindings>(defaultKeybindings);\n  const [url, setUrl] = useState(isDev ? 'test.pdf' : '');\n  const [numPages, setNumPages] = useState(0);\n  const [rotate, setRotate] = useState(0);\n  const [scale, setScale] = useState(1);\n\n  const [pageWidthRaw, setPageWidthRaw] = useState(500);\n  const [pageHeightRaw, setPageHeightRaw] = useState(1000);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const [isColorInverted, setIsColorInverted] = useState(false);\n  const [invertColorRate, setInvertColorRate] = useState(1);\n  const [showInfo, setShowInfo] = useState(isDev);\n\n  const [isScrolling, setIsScrolling] = useState(false);\n  const [scrollOffset, setScrollOffset] = useState(0);\n\n  const [keyword, setKeyword] = useState('');\n  const [isKeywordHighlighted, setIsKeywordHighlighted] = useState(true);\n  const [pdfTexts, setPdfTexts] = useState<string[]>([]);\n  const [keywordHitPages, setKeywordHitPages] = useState<Set<number>>(new Set([]));\n\n  // ref\n  const listRef = useRef<List | null>(null);\n  // NOTE: use outer element of <List> for scrolling.\n  // call `Element.scrollBy` method for scrolling\n  const listOuterRef = useRef<HTMLDivElement | null>(null);\n\n  const startListOuterScroll = (offset: {top: number} | {left: number}) => {\n    if (listOuterRef.current) {\n      startScroll(listOuterRef.current, offset);\n      setIsScrolling(true);\n    }\n  };\n\n  const docRef = useRef<any | null>(null);\n  const commandCallbacksRef = useRef<CommandCallbacks | null>(null);\n  const dropzoneRef = useRef<DropzoneRef | null>(null);\n\n  // context\n  const commandPalette = useContext(CommandPaletteContext);\n  const outlineSelector = useContext(OutlineSelectorContext);\n  const inputBox = useContext(InputBoxContext);\n  const isModalOpen = [commandPalette, outlineSelector, inputBox].some((mdl) => mdl.isOpen);\n\n  // custom hooks\n\n  const [repeatCount, resetRepeatCount] = useRepeatCommand();\n  const repeatCount1 = Math.max(repeatCount, 1);\n\n  const pageHeight = ((rotate / 90) % 2 === 0) ? pageHeightRaw * scale : pageWidthRaw * scale;\n  const pageWidth = ((rotate / 90) % 2 === 0) ? pageWidthRaw * scale : pageHeightRaw * scale;\n  const itemSize = pageHeight + paddingSize;\n\n  const onDocumentLoadSuccess = (pdf: PDFDocumentProxy) => {\n    setPdf(pdf);\n    setNumPages(pdf.numPages);\n    (async () => {\n      // TODO: consider variable page size.\n      const page = await pdf.getPage(1);\n      const [x1, y1, x2, y2] = page.view;\n      setPageWidthRaw(x2 - x1);\n      setPageHeightRaw(y2 - y1);\n      setPdfTexts(await getPdfTexts(pdf));\n    })();\n  };\n\n  const goToOutline = async ({\n    outline, recursive,\n  }: {outline: OutlineNode[] | null, recursive: boolean}) => {\n    if (!pdf || !outline || isModalOpen) return;\n    const result = await outlineSelector.showQuickPick(\n      outline.map((outlineNode) => ({\n        name: outlineNode.title,\n        content: outlineNode\n      }))\n    );\n    if (!result) return;\n    if (recursive && result.content.items?.length) {\n      goToOutline({outline: result.content.items, recursive: true});\n    } else {\n      const targetPageNumber = await outlineNodeToPageNumber({\n        pdf, outlineNode: result.content\n      });\n      jumpPage(targetPageNumber);\n    }\n  };\n\n  const search = async () => {\n    if (!pdf || isModalOpen || pdfTexts.length === 0) return;\n    const newKeyword = await inputBox.showInputBox({\n      prompt: 'input word to search'\n    });\n    if (newKeyword) {\n      const hittedPages = pdfTexts\n        .map((text, idx) => text.includes(keyword) ? idx + 1 : -1)\n        .filter((i) => i > 0);\n\n      if (hittedPages.length > 0) {\n        setKeyword(keyword);\n        setKeywordHitPages(new Set(hittedPages));\n      } else {\n        alert(`can not find keyword: ${keyword}`);\n      }\n    }\n  };\n\n  const searchNext = async (direction: 'forward' | 'backward') => {\n    const step = {forward: 1, backward: -1}[direction];\n    let tmpPageNumber = currentPageNumber + step;\n    while (\n      1 <= tmpPageNumber && tmpPageNumber <= numPages\n      && !keywordHitPages.has(tmpPageNumber)) {\n      tmpPageNumber += step;\n    }\n    if (tmpPageNumber < 1 || tmpPageNumber > numPages) {\n      alert('can not find next search result');\n    } else {\n      jumpPage(tmpPageNumber);\n    }\n  };\n\n  useEffect(() => {\n    const keyupHandler = () => {\n      stopScroll();\n      setIsScrolling(false);\n    };\n    document.addEventListener('keyup', keyupHandler);\n    return () => {\n      document.removeEventListener('keyup', keyupHandler);\n    };\n  }, [setIsScrolling]);\n\n  const currentPageNumber = Math.floor((scrollOffset + height / 2) / itemSize) + 1;\n\n  const jumpPage = (targetPageNumber: number) => {\n    if (!Number.isInteger(targetPageNumber)) return;\n\n    if (targetPageNumber < 0) {\n      // -1 -> numPages\n      targetPageNumber += numPages + 1;\n    }\n    targetPageNumber = Math.max(1, Math.min(numPages, targetPageNumber));\n    listRef.current?.scrollToItem(targetPageNumber - 1);\n  };\n\n  // const [\n  //   _dummy,\n  //   outlineCommandCallbacks,\n  //   {onOutlineLoadSuccess},\n  // ] = useOutlineCommand({\n  //   pdf,\n  //   isModalOpen,\n  //   jumpPage,\n  //   outlineSelector,\n  // });\n\n  const setScaleAndScroll = (newScale: number) => {\n    listRef.current?.scrollTo(scrollOffset * newScale / scale);\n    setScale(newScale);\n  };\n\n  const scrollMax = numPages * itemSize + paddingSize - height;\n\n  const notImplemented = () => alert('sorry not implemented yet');\n\n  const commandCallbacks: CommandCallbacks = {\n    doNothing: () => {},\n\n    ...fullScreenCommandCallbacks,\n\n    showInfoOn: () => setShowInfo(true),\n    showInfoOff: () => setShowInfo(false),\n    showInfoToggle: () => setShowInfo(!showInfo),\n\n    prevPage: () => listRef.current?.scrollTo(Math.max(0, scrollOffset - repeatCount1 * itemSize))\n    ,\n    nextPage: () => listRef.current?.scrollTo(Math.min(scrollMax, scrollOffset + repeatCount1 * itemSize)),\n    firstPage: () => jumpPage(repeatCount1),\n    lastPage: () => jumpPage(repeatCount >= 1 ? repeatCount : -1),\n    goToPage: async () => {\n      if (isModalOpen) return;\n      jumpPage(Number(await inputBox.showInputBox({\n        prompt: 'input page number to go',\n      })));\n    },\n\n    zoomReset: () => setScaleAndScroll(1),\n    zoomIn: () => setScaleAndScroll(Math.min(scale + repeatCount1 * scaleStep, scaleMax)),\n    zoomOut: () => setScaleAndScroll(Math.max(scale - repeatCount1 * scaleStep, scaleMin)),\n    zoomFitWidth: () => setScaleAndScroll(width / (pageWidth / scale)),\n    zoomFitHeight: () => setScaleAndScroll(height / (pageHeight / scale)),\n\n    scrollLeft: () => startListOuterScroll({left: repeatCount1 * -scrollStep}),\n    scrollRight: () => startListOuterScroll({left: repeatCount1 * scrollStep}),\n    scrollUp: () => startListOuterScroll({top: repeatCount1 * -scrollStep}),\n    scrollDown: () => startListOuterScroll({top: repeatCount1 * scrollStep}),\n    scrollHalfPageUp: () => startListOuterScroll({top: repeatCount1 * -scrollHalfPageStep}),\n    scrollHalfPageDown: () => startListOuterScroll({top: repeatCount1 * scrollHalfPageStep}),\n    scrollTop: () => listRef.current?.scrollTo(paddingSize + itemSize * (currentPageNumber - 1)),\n    scrollBottom: () => listRef.current?.scrollTo(paddingSize - height + itemSize * currentPageNumber),\n\n    scrollReset: notImplemented,\n\n    rotateRight: () => setRotate((rotate + 90) % 360),\n    rotateLeft: () => setRotate((rotate + 360 - 90) % 360),\n\n    colorInvert: () => setIsColorInverted(!isColorInverted),\n    invertColorRateUp: () => setInvertColorRate(Math.min(invertColorRate + repeatCount1 * invertColorRateStep, 1)),\n    invertColorRateDown: () => setInvertColorRate(Math.max(invertColorRate - repeatCount1 * invertColorRateStep, 0)),\n\n    search,\n    searchNext: () => searchNext('forward'),\n    searchPrev: () => searchNext('backward'),\n    pickSearchList: notImplemented,\n    highlightToggle: () => setIsKeywordHighlighted(!isKeywordHighlighted),\n\n    goToOutline: () => goToOutline({outline, recursive: false}),\n    goToOutlineRecursive: () => goToOutline({outline, recursive: true}),\n\n    sidebarToggle: () => setIsSidebarOpen(!isSidebarOpen),\n\n    forwardPageHistory: notImplemented,\n    backwardPageHistory: notImplemented,\n\n    commandPaletteOpen: async () => {\n      if (isModalOpen) return;\n      const items = COMMANDS.map((command) => ({\n        name: commandToTitle(command),\n        command,\n        keys: keybindings[command],\n      }));\n\n      const item = await commandPalette.showQuickPick(items);\n      if (item?.command) {\n        commandCallbacksRef.current?.[item.command]?.();\n      }\n    },\n\n    fileOpen: () => dropzoneRef?.current?.open(),\n  };\n\n  commandCallbacksRef.current = commandCallbacks;\n  useKeybindings<AllCommandList>({\n    keybindings, commandCallbacks, commands: COMMANDS,\n    onAfterCommand: resetRepeatCount,\n    enabled: !isModalOpen,\n  });\n\n  const itemData: PageRendererDataType = {\n    scale,\n    rotate,\n    isKeywordHighlighted,\n    keyword,\n    paddingSize,\n    isScrolling,\n    pageWidth,\n  };\n\n  if (!url) {\n    return (\n      <DropFileArea\n        onDropFile={(file: File) => setUrl(URL.createObjectURL(file))}\n        dropzoneRef={dropzoneRef}\n      >\n        <LandingPage\n          keybindings={keybindings}\n        />\n      </DropFileArea>\n    );\n  }\n  return (\n    <DropFileArea\n      onDropFile={(file: File) => setUrl(URL.createObjectURL(file))}\n      dropzoneRef={dropzoneRef}\n    >\n      <div\n        style={{\n          background: 'gray',\n          filter: isColorInverted ? `invert(${invertColorRate})` : '',\n        }}\n      >\n        <Document\n          inputRef={docRef}\n          file={url}\n          onLoadSuccess={onDocumentLoadSuccess}\n          options={{\n            cMapUrl: 'cmaps/',\n            cMapPacked: true,\n          }}\n          loading={<div>loading...</div>}\n          onItemClick={({pageNumber}) => {jumpPage(Number(pageNumber))}}\n        >\n          <SideBar\n            onItemClick={({pageNumber}) => {jumpPage(Number(pageNumber))}}\n            onLoadSuccess={(outline: OutlineNode[]) => {setOutline(outline)}}\n            isOpen={isSidebarOpen}\n          />\n          <List\n            height={height}\n            itemCount={numPages}\n            itemSize={itemSize}\n            width={width}\n            overscanCount={2}\n            itemData={itemData}\n            onScroll={({scrollOffset}) => setScrollOffset(scrollOffset)}\n            ref={listRef}\n            outerRef={listOuterRef}\n          >\n            {PageRenderer}\n          </List>\n        </Document>\n        {\n          showInfo\n          &&\n          <div\n            style={{\n              position: 'fixed',\n              top: 0,\n              left: 0,\n              backgroundColor: 'rgba(255, 255, 255, 0.5)',\n            }}\n          >\n            <pre><code>\n              state = {\n                JSON.stringify({\n                  url,\n                  height,\n                  width,\n                  page: `${currentPageNumber}/${numPages}`,\n                  scale,\n                  pageWidthRaw,\n                  pageHeightRaw,\n                  pageHeight,\n                  isSidebarOpen,\n                  pdfLoaded: pdf !== null,\n                  scrollOffset,\n                  isColorInverted,\n                  invertColorRate,\n                  rotate,\n                  repeatCount,\n                  isModalOpen,\n                }, null, '  ')\n              }\n            </code></pre>\n          </div>\n        }\n      </div>\n    </DropFileArea>\n  );\n}\n\nexport {\n  KFPDFViewer\n};\n","import {useState, useEffect} from 'react';\n\nconst REPEAT_MAX = 999;\nconst NO_REPEAT = -1;\n\n// some command accept `repeatCount` to repeat the command.\nconst useRepeatCommand = () => {\n  // NOTE: `-1` means `repeatCount is not specified`\n  const [repeatCount, setRepeatCount] = useState(NO_REPEAT);\n\n  useEffect(() => {\n\n    const keypressHandler = (event: KeyboardEvent) => {\n      if ('0123456789'.includes(event.key)) {\n        const num = Number(event.key);\n        setRepeatCount((currentRepeatCount) => {\n          return Math.min(10 * Math.max(currentRepeatCount, 0) + num, REPEAT_MAX);\n        });\n      }\n    };\n\n    const keyupHandler = (event: KeyboardEvent) => {\n      // NOTE: resetRepeatCount must be called after\n      // keypress event of command.\n      if (!('0123456789'.includes(event.key))) {\n        setRepeatCount(NO_REPEAT);\n      }\n    };\n\n    document.addEventListener('keypress', keypressHandler);\n    document.addEventListener('keyup', keyupHandler);\n\n    return () => {\n      document.removeEventListener('keypress', keypressHandler);\n      document.removeEventListener('keyup', keyupHandler);\n    };\n  }, []);\n\n  const resetRepeatCount = () => {\n    setRepeatCount(NO_REPEAT);\n  };\n\n  return [\n    repeatCount,\n    resetRepeatCount,\n  ] as const;\n};\n\nexport {\n  useRepeatCommand,\n  NO_REPEAT,\n};\n","import {useState, useEffect, useRef, useCallback, CSSProperties} from 'react';\nimport {FullScreen, useFullScreenHandle} from 'react-full-screen';\nimport {KFPDFViewer} from './KFPDFViewer';\nimport { CommandPaletteProvider } from './CommandPaletteContext';\nimport { OutlineSelectorProvider } from './OutlineSelectorContext';\nimport { InputBoxProvider } from './InputBoxContext';\nimport {debounce} from 'throttle-debounce';\n\ninterface AppProps {\n}\n\nconst App: React.FC<AppProps> = () => {\n  const modalRootRef = useRef(null);\n  const [fullScreen, setFullScreen] = useState(false);\n  const [screenWidth, setScreenWidth] = useState(document.documentElement.clientWidth);\n  const [screenHeight, setScreenHeight] = useState(document.documentElement.clientHeight);\n\n  useEffect(() => {\n    const onResize = debounce(250, () => {\n      setScreenWidth(document.documentElement.clientWidth);\n      setScreenHeight(document.documentElement.clientHeight);\n    });\n    // TODO: orientationchange event\n    window.addEventListener('resize', onResize);\n    return () => {\n      window.removeEventListener('resize', onResize);\n    }\n  }, []);\n\n\n  const fullScrenHandle = useFullScreenHandle();\n\n  const fullScreenOn = useCallback(() => {\n    if (!fullScreen) {\n      fullScrenHandle.enter();\n    }\n  }, [fullScreen, fullScrenHandle]);\n\n  const fullScreenOff = useCallback(() => {\n    if (fullScreen) {\n      fullScrenHandle.exit();\n    }\n  }, [fullScreen, fullScrenHandle]);\n\n  const fullScreenToggle = useCallback(() => {\n    if (fullScreen) {\n      fullScrenHandle.exit();\n    } else {\n      fullScrenHandle.enter();\n    }\n  }, [fullScreen, fullScrenHandle]);\n\n  const divStyle: CSSProperties = fullScreen\n    ? {\n      width: '100%',\n      height: '100%',\n    }\n    : {\n      width: screenWidth,\n      height: screenHeight,\n    };\n\n  const parentSelector = () => {\n    if(modalRootRef.current) {\n      return modalRootRef.current;\n    } else {\n      return document.body;\n    }\n  };\n\n  const fullScreenCommandCallbacks = {\n    fullScreenOn,\n    fullScreenOff,\n    fullScreenToggle,\n  };\n\n  return (\n    <FullScreen\n      handle={fullScrenHandle}\n      onChange={setFullScreen}\n    >\n      <div ref={modalRootRef}>\n        <CommandPaletteProvider\n          parentSelector={parentSelector}\n        >\n          <OutlineSelectorProvider\n            parentSelector={parentSelector}\n          >\n            <InputBoxProvider\n              parentSelector={parentSelector}\n            >\n              <div\n                style={divStyle}\n              >\n                <KFPDFViewer\n                  fullScreenCommandCallbacks={fullScreenCommandCallbacks}\n                  height={screenHeight}\n                  width={screenWidth}\n                />\n              </div>\n            </InputBoxProvider>\n          </OutlineSelectorProvider>\n        </CommandPaletteProvider>\n      </div>\n    </FullScreen>\n  );\n}\n\nexport {\n  App\n};\n","import 'normalize.css';\nimport './index.css';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport reportWebVitals from './reportWebVitals';\n\nimport {App} from './components/App';\nimport {isDev} from './env';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nif (isDev) {\n  serviceWorkerRegistration.unregister();\n} else {\n  serviceWorkerRegistration.register();\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}